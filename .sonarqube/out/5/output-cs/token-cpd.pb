ß2
iD:\DanLirisDevelopment\id.co.danliris-weaving-web\src\Infrastructure.EntityFrameworkCore\AggregateRoot.cs
	namespace 	
Infrastructure
 
. 
Domain 
{		 
public

 

abstract

 
class

 
AggregateRoot

 '
<

' (
TAggregateRoot

( 6
,

6 7

TReadModel

8 B
>

B C
:

D E
Entity

F L
,

L M
IAggregateRoot

N \
where 

TReadModel 
: 
ReadModelBase (
{ 
	protected 
AggregateRoot 
(  
Guid  $
identity% -
)- .
{ 	
Identity 
= 
identity 
;  
this 
. 
MarkTransient 
( 
)  
;  !
} 	
	protected 
AggregateRoot 
(  

TReadModel  *
	readModel+ 4
)4 5
{ 	
Identity 
= 
	readModel  
.  !
Identity! )
;) *
	ReadModel 
= 
	readModel !
;! "
} 	
	protected 

TReadModel 
	ReadModel &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 

TReadModel 
GetReadModel &
(& '
)' (
{ 	
if 
( 
this 
. 
IsTransient  
(  !
)! "
)" #
{   
if!! 
(!! 
	ReadModel!! 
.!! 
DomainEvents!! *
==!!+ -
null!!. 2
||!!3 5
!!!6 7
	ReadModel!!7 @
.!!@ A
DomainEvents!!A M
.!!M N
Any!!N Q
(!!Q R
o!!R S
=>!!T V
o!!W X
is!!Y [
OnEntityCreated!!\ k
<!!k l
TAggregateRoot!!l z
>!!z {
)!!{ |
)!!| }
	ReadModel"" 
."" 
AddDomainEvent"" ,
("", -
new""- 0
OnEntityCreated""1 @
<""@ A
TAggregateRoot""A O
>""O P
(""P Q
	GetEntity""Q Z
(""Z [
)""[ \
)""\ ]
)""] ^
;""^ _
}## 
return%% 
	ReadModel%% 
;%% 
}&& 	
	protected(( 
abstract(( 
TAggregateRoot(( )
	GetEntity((* 3
(((3 4
)((4 5
;((5 6
public** 
IAuditTrail** 

AuditTrail** %
=>**& (
	ReadModel**) 2
;**2 3
public,, 
ISoftDelete,, 

SoftDelete,, %
=>,,& (
	ReadModel,,) 2
;,,2 3
	protected.. 
override.. 
void.. 
MarkModified..  ,
(.., -
)..- .
{// 	
if00 
(00 
!00 
this00 
.00 
IsTransient00 !
(00! "
)00" #
)00# $
{11 
	Validator22 
.22 
ThrowWhenTrue22 '
(22' (
(22( )
)22) *
=>22+ -
	IsRemoved22. 7
(227 8
)228 9
,229 :
$str22; t
)22t u
;22u v
base44 
.44 
MarkModified44 !
(44! "
)44" #
;44# $
if55 
(55 
	ReadModel55 
.55 
DomainEvents55 *
==55+ -
null55. 2
||553 5
!556 7
	ReadModel557 @
.55@ A
DomainEvents55A M
.55M N
Any55N Q
(55Q R
o55R S
=>55T V
o55W X
is55Y [
OnEntityUpdated55\ k
<55k l
TAggregateRoot55l z
>55z {
)55{ |
)55| }
	ReadModel66 
.66 
AddDomainEvent66 ,
(66, -
new66- 0
OnEntityUpdated661 @
<66@ A
TAggregateRoot66A O
>66O P
(66P Q
	GetEntity66Q Z
(66Z [
)66[ \
)66\ ]
)66] ^
;66^ _
}77 
}88 	
	protected:: 
override:: 
void:: 
MarkRemoved::  +
(::+ ,
)::, -
{;; 	
if<< 
(<< 
!<< 
this<< 
.<< 
IsTransient<< !
(<<! "
)<<" #
)<<# $
{== 
base>> 
.>> 
MarkRemoved>>  
(>>  !
)>>! "
;>>" #
if@@ 
(@@ 
	ReadModel@@ 
.@@ 
DomainEvents@@ *
==@@+ -
null@@. 2
||@@3 5
!@@6 7
	ReadModel@@7 @
.@@@ A
DomainEvents@@A M
.@@M N
Any@@N Q
(@@Q R
o@@R S
=>@@T V
o@@W X
is@@Y [
OnEntityDeleted@@\ k
<@@k l
TAggregateRoot@@l z
>@@z {
)@@{ |
)@@| }
	ReadModelAA 
.AA 
AddDomainEventAA ,
(AA, -
newAA- 0
OnEntityDeletedAA1 @
<AA@ A
TAggregateRootAAA O
>AAO P
(AAP Q
	GetEntityAAQ Z
(AAZ [
)AA[ \
)AA\ ]
)AA] ^
;AA^ _
ifDD 
(DD 
	ReadModelDD 
.DD 
DomainEventsDD *
.DD* +
AnyDD+ .
(DD. /
oDD/ 0
=>DD1 3
oDD4 5
isDD6 8
OnEntityUpdatedDD9 H
<DDH I
TAggregateRootDDI W
>DDW X
)DDX Y
)DDY Z
{EE 
	ReadModelFF 
.FF 
DomainEventsFF *
.FF* +
WhereFF+ 0
(FF0 1
oFF1 2
=>FF3 5
oFF6 7
isFF8 :
OnEntityUpdatedFF; J
<FFJ K
TAggregateRootFFK Y
>FFY Z
)FFZ [
.GG 
ToListGG 
(GG  
)GG  !
.HH 
ForEachHH  
(HH  !
oHH! "
=>HH# %
	ReadModelHH& /
.HH/ 0
RemoveDomainEventHH0 A
(HHA B
oHHB C
)HHC D
)HHD E
;HHE F
}II 
}JJ 
}KK 	
}LL 
}MM π
mD:\DanLirisDevelopment\id.co.danliris-weaving-web\src\Infrastructure.EntityFrameworkCore\Commands\ICommand.cs
	namespace 	
Infrastructure
 
. 
Domain 
.  
Commands  (
{ 
public 

	interface 
ICommand 
< 
	TResponse '
>' (
:) *
IRequest+ 3
<3 4
	TResponse4 =
>= >
{ 
} 
public		 

	interface		 
ICommandHandler		 $
<		$ %
TComand		% ,
,		, -
	TResponse		. 7
>		7 8
:		9 :
IRequestHandler		; J
<		J K
TComand		K R
,		R S
	TResponse		T ]
>		] ^
where		_ d
TComand		e l
:		m n
ICommand		o w
<		w x
	TResponse			x Å
>
		Å Ç
{

 
} 
} ì&
fD:\DanLirisDevelopment\id.co.danliris-weaving-web\src\Infrastructure.EntityFrameworkCore\EntityBase.cs
	namespace 	
Infrastructure
 
. 
Domain 
{ 
public		 

abstract		 
class		 

EntityBase		 $
<		$ %
TEntity		% ,
>		, -
:		. /
ReadModelBase		0 =
{

 
	protected 

EntityBase 
( 
Guid !
identity" *
)* +
:, -
base. 2
(2 3
identity3 ;
); <
{ 	
this 
. 
MarkTransient 
( 
)  
;  !
this 
. 
AddDomainEvent 
(  
new  #
OnEntityCreated$ 3
<3 4
TEntity4 ;
>; <
(< =
	GetEntity= F
(F G
)G H
)H I
)I J
;J K
} 	
public 
IAuditTrail 

AuditTrail %
=>& (
this) -
;- .
public 
ISoftDelete 

SoftDelete %
=>& (
this) -
;- .
	protected 
override 
void 
MarkModified  ,
(, -
)- .
{ 	
if 
( 
! 
this 
. 
IsTransient !
(! "
)" #
)# $
{ 
Moonlay 
. 
	Validator !
.! "
ThrowWhenTrue" /
(/ 0
(0 1
)1 2
=>3 5
	IsRemoved6 ?
(? @
)@ A
,A B
$strC |
)| }
;} ~
base 
. 
MarkModified !
(! "
)" #
;# $
if 
( 
this 
. 
DomainEvents %
==& (
null) -
||. 0
!1 2
this2 6
.6 7
DomainEvents7 C
.C D
AnyD G
(G H
oH I
=>J L
oM N
isO Q
OnEntityUpdatedR a
<a b
TEntityb i
>i j
)j k
)k l
this 
. 
AddDomainEvent '
(' (
new( +
OnEntityUpdated, ;
<; <
TEntity< C
>C D
(D E
	GetEntityE N
(N O
)O P
)P Q
)Q R
;R S
} 
}   	
	protected"" 
abstract"" 
TEntity"" "
	GetEntity""# ,
("", -
)""- .
;"". /
	protected$$ 
override$$ 
void$$ 
MarkRemoved$$  +
($$+ ,
)$$, -
{%% 	
if&& 
(&& 
!&& 
this&& 
.&& 
IsTransient&& !
(&&! "
)&&" #
)&&# $
{'' 
base(( 
.(( 
MarkRemoved((  
(((  !
)((! "
;((" #
if** 
(** 
this** 
.** 
DomainEvents** %
==**& (
null**) -
||**. 0
!**1 2
this**2 6
.**6 7
DomainEvents**7 C
.**C D
Any**D G
(**G H
o**H I
=>**J L
o**M N
is**O Q
OnEntityDeleted**R a
<**a b
TEntity**b i
>**i j
)**j k
)**k l
this++ 
.++ 
AddDomainEvent++ '
(++' (
new++( +
OnEntityDeleted++, ;
<++; <
TEntity++< C
>++C D
(++D E
	GetEntity++E N
(++N O
)++O P
)++P Q
)++Q R
;++R S
if.. 
(.. 
this.. 
... 
DomainEvents.. %
...% &
Any..& )
(..) *
o..* +
=>.., .
o../ 0
is..1 3
OnEntityUpdated..4 C
<..C D
TEntity..D K
>..K L
)..L M
)..M N
{// 
this00 
.00 
DomainEvents00 %
.00% &
Where00& +
(00+ ,
o00, -
=>00. 0
o001 2
is003 5
OnEntityUpdated006 E
<00E F
TEntity00F M
>00M N
)00N O
.11 
ToList11 
(11  
)11  !
.22 
ForEach22  
(22  !
o22! "
=>22# %
this22& *
.22* +
RemoveDomainEvent22+ <
(22< =
o22= >
)22> ?
)22? @
;22@ A
}33 
}44 
}55 	
}66 
}77 ˛
tD:\DanLirisDevelopment\id.co.danliris-weaving-web\src\Infrastructure.EntityFrameworkCore\ReadModels\ReadModelBase.cs
	namespace 	
Infrastructure
 
. 
Domain 
.  

ReadModels  *
{ 
public 

abstract 
class 
ReadModelBase '
:( )
	ReadModel* 3
,3 4
IEntity5 <
,< =
IAuditTrail> I
,I J
ISoftDeleteK V
{		 
	protected

 
ReadModelBase

 
(

  
Guid

  $
identity

% -
)

- .
{ 	
Identity 
= 
identity 
;  
} 	
[ 	
	Timestamp	 
] 
public 
byte 
[ 
] 

RowVersion  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
string 
	CreatedBy 
{  !
get" %
;% &
set' *
;* +
}, -
public 
DateTimeOffset 
CreatedDate )
{* +
get, /
;/ 0
set1 4
;4 5
}6 7
public 
string 

ModifiedBy  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
DateTimeOffset 
? 
ModifiedDate +
{, -
get. 1
;1 2
set3 6
;6 7
}8 9
public 
bool 
? 
Deleted 
{ 
get "
;" #
set$ '
;' (
}) *
public 
DateTimeOffset 
? 
DeletedDate *
{+ ,
get- 0
;0 1
set2 5
;5 6
}7 8
public   
string   
	DeletedBy   
{    !
get  " %
;  % &
set  ' *
;  * +
}  , -
}## 
}$$ ã

}D:\DanLirisDevelopment\id.co.danliris-weaving-web\src\Infrastructure.EntityFrameworkCore\Repositories\IAggregateRepository.cs
	namespace 	
Infrastructure
 
. 
Domain 
.  
Repositories  ,
{ 
public 

	interface  
IAggregateRepository )
<) *

TAggregate* 4
,4 5

TReadModel6 @
>@ A
:B C
IEntityRepositoryD U
<U V

TAggregateV `
>` a
{		 

IQueryable

 
<

 

TReadModel

 
>

 
Query

 $
{

% &
get

' *
;

* +
}

, -
List 
< 

TAggregate 
> 
Find 
( 

Expression (
<( )
Func) -
<- .

TReadModel. 8
,8 9
bool: >
>> ?
>? @
	conditionA J
)J K
;K L
List 
< 

TAggregate 
> 
Find 
( 

IQueryable (
<( )

TReadModel) 3
>3 4

readModels5 ?
)? @
;@ A
} 
} “
zD:\DanLirisDevelopment\id.co.danliris-weaving-web\src\Infrastructure.EntityFrameworkCore\Repositories\IEntityRepository.cs
	namespace 	
Infrastructure
 
. 
Domain 
.  
Repositories  ,
{ 
public 

	interface 
IEntityRepository &
<& '
TEntity' .
>. /
:0 1
IRepository2 =
{ 
Task 
Update 
( 
TEntity 
entity "
)" #
;# $
}		 
}

 ÷'
nD:\DanLirisDevelopment\id.co.danliris-weaving-web\src\Infrastructure.EntityFrameworkCore\ValueObjects\ListX.cs
	namespace 	
System
 
. 
Collections 
. 
Generic $
{ 
public 

class 
ListX 
< 
T 
> 
: 
List  
<  !
T! "
>" #
{ 
public 
ListX 
( 
) 
: 
base 
( 
) 
{ 	
}		 	
public 
ListX 
( 
IEnumerable  
<  !
T! "
>" #

collection$ .
). /
:0 1
base2 6
(6 7

collection7 A
)A B
{ 	
} 	
public 
override 
bool 
Equals #
(# $
object$ *
obj+ .
). /
{ 	
ListX 
< 
T 
> 
other 
= 
( 
ListX #
<# $
T$ %
>% &
)& '
obj' *
;* +
IEnumerator 
< 
T 
> 

thisValues %
=& '
this( ,
., -
GetEnumerator- :
(: ;
); <
;< =
IEnumerator 
< 
T 
> 
otherValues &
=' (
other) .
.. /
GetEnumerator/ <
(< =
)= >
;> ?
while 
( 

thisValues 
. 
MoveNext &
(& '
)' (
&&) +
otherValues, 7
.7 8
MoveNext8 @
(@ A
)A B
)B C
{ 
if 
( 
ReferenceEquals #
(# $

thisValues$ .
.. /
Current/ 6
,6 7
null8 <
)< =
^> ?
ReferenceEquals@ O
(O P
otherValuesP [
.[ \
Current\ c
,c d
nulle i
)i j
)j k
{ 
return 
false  
;  !
} 
if 
( 
! 

thisValues 
.  
Current  '
.' (
Equals( .
(. /
otherValues/ :
.: ;
Current; B
)B C
)C D
{ 
return 
false  
;  !
} 
} 
return!! 
!!! 

thisValues!! 
.!! 
MoveNext!! '
(!!' (
)!!( )
&&!!* ,
!!!- .
otherValues!!. 9
.!!9 :
MoveNext!!: B
(!!B C
)!!C D
;!!D E
}"" 	
public$$ 
override$$ 
int$$ 
GetHashCode$$ '
($$' (
)$$( )
{%% 	
return&& 
this&& 
.&& 
Select&& 
(&& 
x&&  
=>&&! #
x&&$ %
.&&% &
GetHashCode&&& 1
(&&1 2
)&&2 3
)&&3 4
.'' 
	Aggregate'' 
('' 
('' 
x'' 
,'' 
y'' 
)'' 
=>'' !
x''" #
^''$ %
y''& '
)''' (
;''( )
}(( 	
public** 
static** 
bool** 
operator** #
==**$ &
(**& '
ListX**' ,
<**, -
T**- .
>**. /
left**0 4
,**4 5
ListX**6 ;
<**; <
T**< =
>**= >
right**? D
)**D E
{++ 	
if,, 
(,, 
ReferenceEquals,, 
(,,  
left,,  $
,,,$ %
null,,& *
),,* +
^,,, -
ReferenceEquals,,. =
(,,= >
right,,> C
,,,C D
null,,E I
),,I J
),,J K
{-- 
return.. 
false.. 
;.. 
}// 
return00 
ReferenceEquals00 "
(00" #
left00# '
,00' (
null00) -
)00- .
||00/ 1
left002 6
.006 7
Equals007 =
(00= >
right00> C
)00C D
;00D E
}11 	
public33 
static33 
bool33 
operator33 #
!=33$ &
(33& '
ListX33' ,
<33, -
T33- .
>33. /
left330 4
,334 5
ListX336 ;
<33; <
T33< =
>33= >
right33? D
)33D E
{44 	
return55 
!55 
(55 
left55 
==55 
right55 "
)55" #
;55# $
}66 	
}77 
}88 